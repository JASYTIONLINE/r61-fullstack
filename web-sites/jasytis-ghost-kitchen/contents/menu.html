<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ghost Kitchen – Menu</title>

  <!--
    Load Bootstrap for quick, responsive layout.
    No local CSS is used; everything relies on Bootstrap utilities.
  -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet">
</head>

<body class="bg-light">

  <!-- =========================================================
       PAGE HEADER / NAVBAR
       ---------------------------------------------------------
       A basic header with a title and a button to go to cart.html.
       Bootstrap handles the layout with flex utilities.
       ========================================================= -->
  <nav class="navbar navbar-light bg-white shadow-sm px-3">
    <span class="navbar-brand mb-0 h1">Ghost Kitchen</span>
    <button class="btn btn-outline-primary" id="cartButton">View Cart</button>
  </nav>

  <!-- =========================================================
       MENU CONTAINER
       ---------------------------------------------------------
       This section holds all menu items dynamically loaded
       from the Firebase Realtime Database.
       Each item will appear as a Bootstrap "card".
       ========================================================= -->
  <div class="container my-4">
    <h3 class="text-center mb-4">Our Menu</h3>

    <!--
      This row will be filled with menu cards created in JavaScript.
      The JS below will target this <div> by its ID and insert HTML.
    -->
    <div class="row" id="menuContainer">
      <!-- Menu items will be injected here -->
    </div>
  </div>

  <!-- =========================================================
       SCRIPTS
       ========================================================= -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
  </script>

  <script type="module">
    /*
      Import only what we need from app.js.
      readData() listens for live updates from the specified Firebase path.
    */
    import { readData } from "./jasytis-ghost-kitchen/assets/js/app.js";

    /*
      The HTML element that will receive all the menu cards.
      We select it once and reuse the reference for efficiency.
    */
    const menuContainer = document.getElementById("menuContainer");

    /*
      A helper function to build the HTML for each menu item.
      It receives the item's data (object) and returns a Bootstrap card.
    */
    function createMenuCard(itemId, itemData) {
      return `
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm">
            <img src="${itemData.image || 'https://via.placeholder.com/300'}"
                 class="card-img-top"
                 alt="${itemData.name}">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${itemData.name}</h5>
              <p class="card-text mb-1">${itemData.category || 'Uncategorized'}</p>
              <p class="card-text fw-bold">$${itemData.price}</p>
              <button
                class="btn btn-success mt-auto"
                onclick="addToCart('${itemId}', '${itemData.name}', ${itemData.price})">
                Add to Cart
              </button>
            </div>
          </div>
        </div>`;
    }

    /*
      The addToCart() function will later store selections in localStorage
      so the cart page can read them.  For now, it simply logs the click.
      Declared on window so inline onclick handlers can access it.
    */
    window.addToCart = function (id, name, price) {
      console.log(`Item added to cart: ${name} ($${price})`);
      // placeholder — we’ll implement cart logic in cart.html
    };

    /*
      readData("menu", callback)
      --------------------------------------------
      Listens to the "menu" node in Firebase.
      Every time the data changes, the callback executes,
      replacing the contents of #menuContainer with fresh cards.
    */
    readData("menu", (menuItems) => {
      // Clear the container before re-rendering
      menuContainer.innerHTML = "";

      // menuItems is an object where each key is a menu item ID.
      if (menuItems) {
        Object.entries(menuItems).forEach(([id, item]) => {
          // Append each card’s HTML to the container
          menuContainer.innerHTML += createMenuCard(id, item);
        });
      } else {
        // If no data exists yet, show a friendly message
        menuContainer.innerHTML = `
          <p class="text-center text-muted">No menu items found.</p>
        `;
      }
    });

    /*
      When the "View Cart" button is clicked, go to cart.html.
      We’ll build that file next.
    */
    document.getElementById("cartButton").addEventListener("click", () => {
      window.location.href = "cart.html";
    });
  </script>
</body>
</html>
